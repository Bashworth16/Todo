<html>
<div>
    <h1>To-do List</h1>
</div>
<body>
<div id="tasks">
<script>
    function loadList() {
        fetch('http://127.0.0.1:8000/api/v1/tasks')
            .then(response => {
                if (!response.ok) {
                    throw Error(`${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log(data.items);
                const html = data.items.map(task => {
                    return `<p id=${task.id}>ID: ${task.id}  ${task.task}
                        <button onclick= completeTask(${task.id})>
                            Complete Task </button>
                        <button onclick="location.href='api/v1/task/{{task.id}}';">
                            Update </button></p>`}).join('')
                document.querySelector('#tasks').insertAdjacentHTML('afterbegin', html);
            })
            .catch(error => {
                console.log(error);
            });
        };

    function completeTask(id) {
        let url = 'http://127.0.0.1:8000/home'
        fetch(`http://127.0.0.1:8000/api/v1/task/${id}`, {method: 'DELETE'})
            .then(response => {
            const div = document.getElementById(id);
            div.remove();
            });
    };

    function postTask() {
        fetch('http://127.0.0.1:8000/api/v1/tasks', {method: 'POST'})
            .then(response => {
                location.reload(true)
                });
    }

    loadList()
</script>
</div>

<form action="api/v1/tasks" method="POST">
    <input type="submit" value="Add Task"/>
    <input type="text" name="new_task"/>
</form>

<form action="api/v1/task/" method="GET">
    <input type="submit" value="ID Search"/>
    <input type="text" name="search_text"/>
</form>

</body>
</html>