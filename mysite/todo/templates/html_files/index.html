<div>
    <h1>To-do List</h1>
</div>

<body>
<div id="tasks">
<script>
    // Load task list to home screen
    function loadList() {
        fetch('api/v1/tasks')
        .then(response => {
            if (!response.ok) {
            throw Error(`${response.status}`);
            }
        return response.json();
        })
        .then(data => {
            const html = data.items.map(task => {
                return `<p id=${task.id}>ID: ${task.id}  ${task.task}
                    <button onclick= completeTask(${task.id})>
                        Complete Task </button>
                    <button onclick=upDate(${task.id})>
                        Update </button></p>`;}).join('');
            document.querySelector('#tasks').insertAdjacentHTML('afterbegin', html);
        })
        .catch(error => {
            console.log(error);
        });
    }

    // Complete task
    function completeTask(id) {
        fetch(`http://127.0.0.1:8000/api/v1/task/${id}`, {
            method: 'DELETE'
        })
        .then(response => {
            const div = document.getElementById(id);
            div.remove();
            return console.log(`Response ${response} deleted.`);
        });
    }

    // Post Task Feature
    function postTask(new_task) {
        const newTask = new FormData();
        newTask.append('task', new_task);
        const data = JSON.stringify({'task': new_task});

        fetch('api/v1/tasks', {
            method: 'POST',
            body: data
        })
        .then(response => {
            if (!response.ok) {
                throw Error(`${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            data = Object.keys(data)
                .map(function(key)
                    {return data[key];}
                );
            console.log(data);
            const html = data.slice(0, 1).map(task => {
                const values = `ID: ${data[0]} ${data[1]}`
                return `<p id=${data[0]}>
                    ${values}
                        <button onclick= completeTask(${data[0]})>
                            Complete Task </button>
                        <button onclick=upDate(${data[0]})>
                            Update </button></p>`;
            }).join('');
        document.querySelector('#tasks').insertAdjacentHTML('beforeend', html);
        })
        .catch(error => {
            console.log(error);
        });
        document.getElementById('new_task').value = '';
    }

      // Submit function
    function submit(id) {
        const text = document.getElementById('txtBox').value;
        const oldText = document.getElementById(`${id}`).innerHTML = `<p id=${id}>
                    ID: ${id} ${text}
                        <button onclick= completeTask(${id})>
                            Complete Task </button>
                        <button onclick=upDate(${id})>
                            Update </button></p>`;
        const text_box_val = JSON.stringify({'task': text});
        fetch(`api/v1/task/${id}`, {
            method: "PUT",
            body: text_box_val
        });
        document.getElementById("txtBox").remove();
        document.getElementById("submit").remove();
    }

    // Update Feature
    function upDate(id) {
        console.log(id);
        const text_box = `<input id="txtBox" type="text" name="task_update"/>`;
        const submitButton = `<button id='submit' onclick=submit(${id})>
                Submit </button>`;
        const html = (text_box + submitButton);
        document.getElementById(id).insertAdjacentHTML('beforeend', html);
    }

    function clear() {
        const sRs = document.getElementById('search_results');
        console.log(sRs)};

    function getTask(search) {
        const html = '<div id="search_results"></div>';
        document.getElementById('results').insertAdjacentHTML('beforeend', html);
        console.log(document.getElementById('results').innerHTML)
        fetch(`api/v1/task/${search}`, {
            method: 'GET'
        })
        .then(response => {
            if (!response.ok) {
                throw Error(`${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            data = Object.keys(data)
                    .map(function(key)
                        {return data[key];}
                    );
            const html = data.slice(0, 1).map(task => {
                return `<p id='search_result'>ID: ${data[0]}  ${data[1]}
                    <button onclick= completeTask(${data[0]})>
                        Complete Task </button>
                    <button onclick=upDate(${data[0]})>
                        Update </button>
                    <button onclick=>
                        Clear </button></p>`;}).join('');
            document.querySelector('#search_results').insertAdjacentHTML('beforeend', html);
        })
        .catch(error => {
            document.getElementById('results').value = 'No Results...';
            console.log(error);
        });
        document.getElementById('search_task').value = '';
    }
    loadList();
</script>
</div>

<div>
    <button type="input" onclick=postTask(document.getElementById('new_task').value)>
        Add Task </button>
    <input id="new_task" type="text" name="task_text"/>
</div>
<div>
    <button type="input" onclick=getTask(document.getElementById('search_task').value)>
        Search ID </button>
    <input id="search_task" type="text"/>
</div>
<p id="results"> Search Results:
</p>
</body>